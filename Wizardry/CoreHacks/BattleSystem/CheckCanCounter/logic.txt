SetBattleUnitWeapon(attacker) + SetBattleUnitWeapon(target, auto)
↓
BattleInitTargetCanCounter
↓
BattleGenerate